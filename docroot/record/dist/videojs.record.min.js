/*!
 * videojs-record
 * @version 3.9.0
 * @see https://github.com/collab-project/videojs-record
 * @copyright 2014-2020 Collab
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("videojs"),require("RecordRTC")):"function"==typeof define&&define.amd?define("VideojsRecord",["videojs","RecordRTC"],t):"object"==typeof exports?exports.VideojsRecord=t(require("videojs"),require("RecordRTC")):e.VideojsRecord=t(e.videojs,e.RecordRTC)}(window,(function(e,t){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(t,i){t.exports=e},function(e,t,i){(function(t){var i;i="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=i}).call(this,i(4))},function(e,i){e.exports=t},function(e,t,i){i(6),e.exports=i(5)},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){},function(e,t,i){"use strict";i.r(t);var r=i(0),s=i.n(r);const o=s.a.getComponent("Component");class a extends o{createEl(){return super.createEl("div",{className:"vjs-animation-display",innerHTML:"<img />"})}}o.registerComponent("AnimationDisplay",a);var n=a;const h=s.a.getComponent("Component");class d extends h{createEl(){return super.createEl("div",{className:"vjs-record-canvas",innerHTML:"<canvas></canvas>"})}}h.registerComponent("RecordCanvas",d);var c=d;const l=s.a.getComponent("Button"),p=s.a.getComponent("Component");class u extends l{handleClick(e){this.player_.record().getDevice()}show(){this.layoutExclude&&!0===this.layoutExclude||super.show()}}u.prototype.controlText_="Device",p.registerComponent("DeviceButton",u);var y=u;class g{}g.READY="ready",g.ERROR="error",g.PLAYING="playing",g.LOADEDMETADATA="loadedmetadata",g.LOADSTART="loadstart",g.USERINACTIVE="userinactive",g.TIMEUPDATE="timeupdate",g.DURATIONCHANGE="durationchange",g.ENDED="ended",g.PAUSE="pause",g.PLAY="play",g.DEVICE_READY="deviceReady",g.DEVICE_ERROR="deviceError",g.START_RECORD="startRecord",g.STOP_RECORD="stopRecord",g.FINISH_RECORD="finishRecord",g.RECORD_COMPLETE="recordComplete",g.PROGRESS_RECORD="progressRecord",g.TIMESTAMP="timestamp",g.ENUMERATE_READY="enumerateReady",g.ENUMERATE_ERROR="enumerateError",g.AUDIO_BUFFER_UPDATE="audioBufferUpdate",g.AUDIO_OUTPUT_READY="audioOutputReady",g.START_CONVERT="startConvert",g.FINISH_CONVERT="finishConvert",g.ENTER_PIP="enterPIP",g.LEAVE_PIP="leavePIP",g.RETRY="retry",g.ENTERPICTUREINPICTURE="enterpictureinpicture",g.LEAVEPICTUREINPICTURE="leavepictureinpicture",Object.freeze(g);var m=g;const v=s.a.getComponent("Button"),R=s.a.getComponent("Component");class E extends v{buildCSSClass(){return"vjs-camera-button vjs-control vjs-button vjs-icon-photo-camera"}enable(){super.enable(),this.on(this.player_,m.START_RECORD,this.onStart),this.on(this.player_,m.STOP_RECORD,this.onStop)}disable(){super.disable(),this.off(this.player_,m.START_RECORD,this.onStart),this.off(this.player_,m.STOP_RECORD,this.onStop)}show(){this.layoutExclude&&!0===this.layoutExclude||super.show()}handleClick(e){let t=this.player_.record();t.isProcessing()?(t.retrySnapshot(),this.onStop(),this.player_.trigger(m.RETRY)):t.start()}onStart(e){this.removeClass("vjs-icon-photo-camera"),this.addClass("vjs-icon-replay"),this.controlText("Retry")}onStop(e){this.removeClass("vjs-icon-replay"),this.addClass("vjs-icon-photo-camera"),this.controlText("Image")}}E.prototype.controlText_="Image",R.registerComponent("CameraButton",E);var T=E;const f=s.a.getComponent("Button"),b=s.a.getComponent("Component");class D extends f{buildCSSClass(){return"vjs-record-button vjs-control vjs-button vjs-icon-record-start"}enable(){super.enable(),this.on(this.player_,m.START_RECORD,this.onStart),this.on(this.player_,m.STOP_RECORD,this.onStop)}disable(){super.disable(),this.off(this.player_,m.START_RECORD,this.onStart),this.off(this.player_,m.STOP_RECORD,this.onStop)}show(){this.layoutExclude&&!0===this.layoutExclude||super.show()}handleClick(e){let t=this.player_.record();t.isRecording()?t.stop():t.start()}onStart(e){this.removeClass("vjs-icon-record-start"),this.addClass("vjs-icon-record-stop"),this.controlText("Stop")}onStop(e){this.removeClass("vjs-icon-record-stop"),this.addClass("vjs-icon-record-start"),this.controlText("Record")}}D.prototype.controlText_="Record",b.registerComponent("RecordToggle",D);var C=D;const _=s.a.getComponent("Component");class A extends _{constructor(e,t){super(e,t),this.enable()}createEl(){let e={"data-label":this.localize("REC")};return super.createEl("div",{className:"vjs-record-indicator vjs-control",dir:"ltr"},e)}enable(){this.on(this.player_,m.START_RECORD,this.show),this.on(this.player_,m.STOP_RECORD,this.hide)}disable(){this.off(this.player_,m.START_RECORD,this.show),this.off(this.player_,m.STOP_RECORD,this.hide)}show(){this.layoutExclude&&!0===this.layoutExclude||super.show()}}_.registerComponent("RecordIndicator",A);var O=A;const w=s.a.getComponent("Button"),S=s.a.getComponent("Component");class P extends w{constructor(e,t){super(e,t),this.on(this.player_,m.ENTER_PIP,this.onStart),this.on(this.player_,m.LEAVE_PIP,this.onStop)}buildCSSClass(){return"vjs-pip-button vjs-control vjs-button vjs-icon-picture-in-picture-start"}show(){this.layoutExclude&&!0===this.layoutExclude||super.show()}async handleClick(e){let t=this.player_.record();this.disable();try{t.mediaElement!==document.pictureInPictureElement?await t.mediaElement.requestPictureInPicture():await document.exitPictureInPicture()}catch(e){this.player_.trigger(m.ERROR,e)}finally{this.enable()}}onStart(e){this.removeClass("vjs-icon-picture-in-picture-start"),this.addClass("vjs-icon-picture-in-picture-stop")}onStop(e){this.removeClass("vjs-icon-picture-in-picture-stop"),this.addClass("vjs-icon-picture-in-picture-start")}}P.prototype.controlText_="Picture in Picture",S.registerComponent("PictureInPictureToggle",P);var k=P;const I="image_only",U="audio_only",L="animation",B=function(e){return e===Object(e)||!0===e};var M=function(e){switch(e.which){case 88:switch(this.player_.record().getRecordType()){case I:this.player_.cameraButton.trigger("click");break;default:this.player_.recordToggle.trigger("click")}break;case 80:!0===this.player_.record().pictureInPicture&&this.player_.pipToggle.trigger("click");break;case 67:this.player_.controlBar.playToggle&&this.player_.controlBar.playToggle.contentEl()&&player.controlBar.playToggle.trigger("click")}};var x={image:!1,audio:!1,video:!1,animation:!1,screen:!1,maxLength:10,maxFileSize:0,msDisplayMax:3,frameWidth:320,frameHeight:240,debug:!1,pip:!1,autoMuteDevice:!1,videoBitRate:1200,videoEngine:"recordrtc",videoFrameRate:30,videoMimeType:"video/webm",videoRecorderType:"auto",videoWorkerURL:"",videoWebAssemblyURL:"",audioEngine:"recordrtc",audioRecorderType:"auto",audioMimeType:"auto",audioBufferSize:4096,audioSampleRate:44100,audioBitRate:128,audioChannels:2,audioWorkerURL:"",audioWebAssemblyURL:"",audioBufferUpdate:!1,animationFrameRate:200,animationQuality:10,imageOutputType:"dataURL",imageOutputFormat:"image/png",imageOutputQuality:.92,timeSlice:0,convertEngine:"",convertWorkerURL:"",convertOptions:[],hotKeys:!1,pluginLibraryOptions:{}};var j=function(e,t,i){e=e<0?0:e,t=t||e;let r=Math.floor(e%60),s=Math.floor(e/60%60),o=Math.floor(e/3600),a=Math.floor(t/60%60),n=Math.floor(t/3600),h=Math.floor(1e3*(e-r));return(isNaN(e)||e===1/0)&&(o=s=r=h="-"),t>0&&t<i?(h<100&&(h=h<10?"00"+h:"0"+h),h=":"+h):h="",o=o>0||n>0?o+":":"",s=((o||a>=10)&&s<10?"0"+s:s)+":",r=r<10?"0"+r:r,o+s+r+h};var N=function(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e};var V=function(e,t){if("string"!=typeof e)return!1;if("string"!=typeof t)return!1;e=e.split("."),t=t.split(".");const i=Math.min(e.length,t.length);let r=0;for(;r<i;++r){if(e[r]=parseInt(e[r],10),t[r]=parseInt(t[r],10),e[r]>t[r])return 1;if(e[r]<t[r])return-1}return e.length===t.length?0:e.length<t.length?-1:1},F=i(1),W=i.n(F);const Y=function(){let e={browser:null,version:null,minVersion:null};if(void 0===W.a||!W.a.navigator)return e.browser="Not a supported browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=H(navigator.userAgent,/Firefox\/(\d+)\./,1),e.minVersion=31;else if(navigator.webkitGetUserMedia)e.browser="chrome",e.version=H(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2),e.minVersion=38;else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=H(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),e.minVersion=10547;else{if(!W.a.RTCPeerConnection||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=H(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}return e},H=function(e,t,i){let r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)};var z=i(2),G=i.n(z);const Q=function(e,t){if(e instanceof Blob||e instanceof File){void 0===t&&(t=new Date);try{e.lastModified=t.getTime(),e.lastModifiedDate=t}catch(e){if(!(e instanceof TypeError))throw e}let i="."+e.type.split("/")[1];i.indexOf(";")>-1&&(i=i.split(";")[0]);try{e.name=t.getTime()+i}catch(e){if(!(e instanceof TypeError))throw e}}},q=s.a.getComponent("Component"),K=["libvorbis.js","recorder.js","lamejs","opus-recorder","vmsg"],$=["webm-wasm"];K.concat($);class J extends q{constructor(e,t){t.evented=!0,super(e,t)}dispose(){void 0!==this.recordedData&&URL.revokeObjectURL(this.recordedData)}destroy(){}addFileInfo(e){Q(e)}onStopRecording(e){this.recordedData=e,this.addFileInfo(this.recordedData),this.dispose(),this.trigger(m.RECORD_COMPLETE)}saveAs(e){!function(e,t){if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(t,e);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(t,e);let i=document.createElement("a");i.href=URL.createObjectURL(t),i.download=e,i.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(i),"function"==typeof i.click?i.click():(i.target="_blank",i.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),URL.revokeObjectURL(i.href)}(e[Object.keys(e)[0]],this.recordedData)}}s.a.RecordEngine=J,q.registerComponent("RecordEngine",J);const X=s.a.getComponent("Component");class Z extends J{setup(e,t,i){this.inputStream=e,this.mediaType=t,this.debug=i,"screen"in this.mediaType&&(this.mediaType.video=!0),void 0!==this.recorderType&&(this.mediaType.video=this.recorderType),this.engine=new G.a.MRecordRTC,this.engine.mediaType=this.mediaType,this.engine.disableLogs=!this.debug,this.engine.mimeType=this.mimeType,this.engine.bufferSize=this.bufferSize,this.engine.sampleRate=this.sampleRate,this.engine.numberOfAudioChannels=this.audioChannels,this.engine.video=this.video,this.engine.canvas=this.canvas,this.engine.bitrate=this.bitRate,this.engine.quality=this.quality,this.engine.frameRate=this.frameRate,void 0!==this.timeSlice&&(this.engine.timeSlice=this.timeSlice,this.engine.onTimeStamp=this.onTimeStamp.bind(this)),this.engine.workerPath=this.workerPath,this.engine.webAssemblyPath=this.videoWebAssemblyURL,this.engine.addStream(this.inputStream)}dispose(){super.dispose(),this.destroy()}destroy(){this.engine&&"function"==typeof this.engine.destroy&&this.engine.destroy()}start(){this.engine.startRecording()}stop(){this.engine.stopRecording(this.onStopRecording.bind(this))}pause(){this.engine.pauseRecording()}resume(){this.engine.resumeRecording()}saveAs(e){this.engine&&void 0!==e&&this.engine.save(e)}onStopRecording(e,t){URL.revokeObjectURL(e);let i=this.player().record().getRecordType();this.engine.getBlob(e=>{switch(i){case U:void 0!==e.audio&&(this.recordedData=e.audio);break;case"video_only":case"audio_video":case"audio_screen":case"screen_only":void 0!==e.video&&(this.recordedData=e.video);break;case L:void 0!==e.gif&&(this.recordedData=e.gif)}this.addFileInfo(this.recordedData),this.trigger(m.RECORD_COMPLETE)})}onTimeStamp(e,t){let i;switch(this.player().currentTimestamp=e,this.player().allTimestamps=t,this.player().record().getRecordType()){case U:i=this.engine.audioRecorder;break;case L:i=this.engine.gifRecorder;break;default:i=this.engine.videoRecorder}let r=!1;if(i&&(i=i.getInternalRecorder()),i instanceof G.a.MediaStreamRecorder==!0&&(this.player().recordedData=i.getArrayOfBlobs(),this.addFileInfo(this.player().recordedData[this.player_.recordedData.length-1]),this.maxFileSize>0)){new Blob(this.player().recordedData).size>=this.maxFileSize&&(r=!0)}this.player().trigger(m.TIMESTAMP),r&&this.player().stop()}}s.a.RecordRTCEngine=Z,X.registerComponent("RecordRTCEngine",Z);var ee=Z;const te=s.a.getComponent("Component");class ie extends te{constructor(e,t){t.evented=!0,super(e,t)}setup(e,t){this.mediaType=e,this.debug=t}loadBlob(e){return t=e,new Promise((e,i)=>{const r=new FileReader;r.onloadend=()=>{e(r.result)},r.onerror=e=>{i(e.error)},r.readAsArrayBuffer(t)});var t}addFileInfo(e,t){Q(e,t)}}s.a.ConvertEngine=ie,te.registerComponent("ConvertEngine",ie);i.d(t,"Record",(function(){return ae}));const re=s.a.getPlugin("plugin"),se=s.a.getComponent("Player"),oe="auto";se.prototype.play=function(){let e=this.techGet_("play");return void 0!==e&&"function"==typeof e.then&&e.then(null,e=>{}),e};class ae extends re{constructor(e,t){super(e,t),e.addClass("vjs-record"),this.loadOptions(),this.resetState();let i="av-perm";switch(this.getRecordType()){case I:case"video_only":case L:i="video-perm";break;case U:i="audio-perm";break;case"screen_only":i="screen-perm";break;case"audio_screen":i="sv-perm"}if(y.prototype.buildCSSClass=()=>"vjs-record vjs-device-button vjs-control vjs-icon-"+i,e.deviceButton=new y(e,t),e.addChild(e.deviceButton),e.recordIndicator=new O(e,t),e.recordIndicator.hide(),e.addChild(e.recordIndicator),e.recordCanvas=new c(e,t),e.recordCanvas.hide(),e.addChild(e.recordCanvas),e.animationDisplay=new n(e,t),e.animationDisplay.hide(),e.addChild(e.animationDisplay),e.cameraButton=new T(e,t),e.cameraButton.hide(),e.recordToggle=new C(e,t),e.recordToggle.hide(),void 0!==s.a.VERSION&&-1!==V(s.a.VERSION,"7.6.0")||(e.pipToggle=new k(e,t),e.pipToggle.hide()),!0===this.pictureInPicture&&(this.onEnterPiPHandler=this.onEnterPiP.bind(this),this.onLeavePiPHandler=this.onLeavePiP.bind(this)),this.player.options_.controlBar){let t=["deviceButton","recordIndicator","cameraButton","recordToggle"];e.pipToggle&&t.push("pipToggle"),t.forEach(e=>{void 0!==this.player.options_.controlBar[e]&&(this.player[e].layoutExclude=!0,this.player[e].hide())})}this.player.one(m.READY,this.setupUI.bind(this))}loadOptions(e={}){let t=s.a.mergeOptions(x,this.player.options_.plugins.record,e);this.recordImage=t.image,this.recordAudio=t.audio,this.recordVideo=t.video,this.recordAnimation=t.animation,this.recordScreen=t.screen,this.maxLength=t.maxLength,this.maxFileSize=t.maxFileSize,this.msDisplayMax=parseFloat(t.msDisplayMax),this.debug=t.debug,this.pictureInPicture=t.pip,this.recordTimeSlice=t.timeSlice,this.autoMuteDevice=t.autoMuteDevice,this.pluginLibraryOptions=t.pluginLibraryOptions,this.videoFrameWidth=t.frameWidth,this.videoFrameHeight=t.frameHeight,this.videoFrameRate=t.videoFrameRate,this.videoBitRate=t.videoBitRate,this.videoEngine=t.videoEngine,this.videoRecorderType=t.videoRecorderType,this.videoMimeType=t.videoMimeType,this.videoWorkerURL=t.videoWorkerURL,this.videoWebAssemblyURL=t.videoWebAssemblyURL,this.convertEngine=t.convertEngine,this.convertWorkerURL=t.convertWorkerURL,this.convertOptions=t.convertOptions,this.audioEngine=t.audioEngine,this.audioRecorderType=t.audioRecorderType,this.audioWorkerURL=t.audioWorkerURL,this.audioWebAssemblyURL=t.audioWebAssemblyURL,this.audioBufferSize=t.audioBufferSize,this.audioSampleRate=t.audioSampleRate,this.audioBitRate=t.audioBitRate,this.audioChannels=t.audioChannels,this.audioMimeType=t.audioMimeType,this.audioBufferUpdate=t.audioBufferUpdate,this.imageOutputType=t.imageOutputType,this.imageOutputFormat=t.imageOutputFormat,this.imageOutputQuality=t.imageOutputQuality,this.animationFrameRate=t.animationFrameRate,this.animationQuality=t.animationQuality}setupUI(){switch(this.player.controlBar.addChild(this.player.cameraButton),this.player.controlBar.el().insertBefore(this.player.cameraButton.el(),this.player.controlBar.el().firstChild),this.player.controlBar.el().insertBefore(this.player.recordToggle.el(),this.player.controlBar.el().firstChild),void 0===this.player.controlBar.pictureInPictureToggle&&void 0!==this.player.pipToggle?this.player.controlBar.addChild(this.player.pipToggle):void 0!==this.player.controlBar.pictureInPictureToggle&&(this.player.pipToggle=this.player.controlBar.pictureInPictureToggle,this.player.pipToggle.hide()),void 0!==this.player.controlBar.remainingTimeDisplay&&(this.player.controlBar.remainingTimeDisplay.el().style.display="none"),void 0!==this.player.controlBar.liveDisplay&&(this.player.controlBar.liveDisplay.el().style.display="none"),this.player.loop(!1),this.getRecordType()){case U:this.surfer=this.player.wavesurfer();break;case I:case"video_only":case"audio_video":case L:case"screen_only":case"audio_screen":this.player.bigPlayButton.hide(),this.player.one(m.LOADEDMETADATA,()=>{this.setDuration(this.maxLength)}),this.player.one(m.LOADSTART,()=>{this.setDuration(this.maxLength)}),!0===this.player.usingNativeControls_&&void 0!==this.player.tech_.el_&&(this.player.tech_.el_.controls=!1),this.player.removeTechControlsListeners_(),this.player.options_.controls&&(void 0!==this.player.controlBar.progressControl&&this.player.controlBar.progressControl.hide(),this.player.on(m.USERINACTIVE,e=>{this.player.userActive(!0)}),this.player.controlBar.show(),this.player.controlBar.el().style.display="flex")}if(this.player.off(m.TIMEUPDATE),this.player.off(m.DURATIONCHANGE),this.player.off(m.LOADEDMETADATA),this.player.off(m.LOADSTART),this.setDuration(this.maxLength),this.player.options_.plugins.record&&this.player.options_.plugins.record.hotKeys&&!1!==this.player.options_.plugins.record.hotKeys){let e=this.player.options_.plugins.record.hotKeys;!0===e&&(e=M),this.player.options_.userActions={hotkeys:e}}void 0!==this.player.controlBar.playToggle&&this.player.controlBar.playToggle.hide()}isRecording(){return this._recording}isProcessing(){return this._processing}isDestroyed(){let e=null===this.player;return!1===e&&(e=null===this.player.children()),e}getDevice(){if(void 0===this.deviceReadyCallback&&(this.deviceReadyCallback=this.onDeviceReady.bind(this)),void 0===this.deviceErrorCallback&&(this.deviceErrorCallback=this.onDeviceError.bind(this)),void 0===this.engineStopCallback&&(this.engineStopCallback=this.onRecordComplete.bind(this)),void 0===this.streamVisibleCallback&&(this.streamVisibleCallback=this.onStreamVisible.bind(this)),"screen_only"===this.getRecordType()||"audio_screen"===this.getRecordType()){if(void 0===navigator.mediaDevices||void 0===navigator.mediaDevices.getDisplayMedia)return void this.player.trigger(m.ERROR,"This browser does not support navigator.mediaDevices.getDisplayMedia")}else if(void 0===navigator.mediaDevices||void 0===navigator.mediaDevices.getUserMedia)return void this.player.trigger(m.ERROR,"This browser does not support navigator.mediaDevices.getUserMedia");switch(this.getRecordType()){case U:this.mediaType={audio:this.audioRecorderType===oe||this.audioRecorderType,video:!1},this.surfer.surfer.microphone.un(m.DEVICE_READY,this.deviceReadyCallback),this.surfer.surfer.microphone.un(m.DEVICE_ERROR,this.deviceErrorCallback),this.surfer.surfer.microphone.on(m.DEVICE_READY,this.deviceReadyCallback),this.surfer.surfer.microphone.on(m.DEVICE_ERROR,this.deviceErrorCallback),this.surfer.setupPlaybackEvents(!1),this.surfer.liveMode=!0,this.surfer.surfer.microphone.paused=!1,"suspended"===this.surfer.surfer.backend.ac.state&&this.surfer.surfer.backend.ac.resume(),!0===this.audioBufferUpdate&&(this.surfer.surfer.microphone.reloadBufferFunction=e=>{this.surfer.surfer.microphone.paused||(this.surfer.surfer.empty(),this.surfer.surfer.loadDecodedBuffer(e.inputBuffer),this.player.recordedData=e.inputBuffer,this.player.trigger(m.AUDIO_BUFFER_UPDATE))}),this.surfer.surfer.microphone.start();break;case I:case"video_only":this.getRecordType()===I&&this.player.el().firstChild.addEventListener(m.PLAYING,this.streamVisibleCallback),this.mediaType={audio:!1,video:this.videoRecorderType===oe||this.videoRecorderType},navigator.mediaDevices.getUserMedia({audio:!1,video:this.getRecordType()===I?this.recordImage:this.recordVideo}).then(this.onDeviceReady.bind(this)).catch(this.onDeviceError.bind(this));break;case"audio_screen":this.mediaType={audio:this.audioRecorderType===oe||this.audioRecorderType,video:this.videoRecorderType===oe||this.videoRecorderType},navigator.mediaDevices.getDisplayMedia({video:!0}).then(e=>{navigator.mediaDevices.getUserMedia({audio:this.recordAudio}).then(t=>{e.addTrack(t.getTracks()[0]),this.onDeviceReady.bind(this)(e)})}).catch(this.onDeviceError.bind(this));break;case"audio_video":this.mediaType={audio:this.audioRecorderType===oe||this.audioRecorderType,video:this.videoRecorderType===oe||this.videoRecorderType},navigator.mediaDevices.getUserMedia({audio:this.recordAudio,video:this.recordVideo}).then(this.onDeviceReady.bind(this)).catch(this.onDeviceError.bind(this));break;case L:this.mediaType={audio:!1,video:!1,gif:!0},navigator.mediaDevices.getUserMedia({audio:!1,video:this.recordAnimation}).then(this.onDeviceReady.bind(this)).catch(this.onDeviceError.bind(this));break;case"screen_only":this.mediaType={audio:!1,video:!1,screen:!0,gif:!1},navigator.mediaDevices.getDisplayMedia({video:!0}).then(this.onDeviceReady.bind(this)).catch(this.onDeviceError.bind(this))}}onDeviceReady(e){if(this._deviceActive=!0,this.stream=e,this.player.deviceButton.hide(),this.setDuration(this.maxLength),this.setCurrentTime(0),void 0!==this.player.controlBar.playToggle&&this.player.controlBar.playToggle.hide(),this.off(this.player,m.TIMEUPDATE,this.playbackTimeUpdate),this.off(this.player,m.ENDED,this.playbackTimeUpdate),this.getRecordType()!==I){if(this.getRecordType()!==U&&(t=this.audioEngine,K.indexOf(t)>-1))throw new Error("Currently "+this.audioEngine+" is only supported in audio-only mode.");let e,i;switch(this.getRecordType()){case U:e=function(e){let t;switch(e){case"recordrtc":t=ee;break;case"libvorbis.js":t=s.a.LibVorbisEngine;break;case"recorder.js":t=s.a.RecorderjsEngine;break;case"lamejs":t=s.a.LamejsEngine;break;case"opus-recorder":t=s.a.OpusRecorderEngine;break;case"vmsg":t=s.a.VmsgEngine;break;default:throw new Error("Unknown audioEngine: "+e)}return t}(this.audioEngine),i=this.audioEngine;break;default:e=function(e){let t;switch(e){case"recordrtc":t=ee;break;case"webm-wasm":t=s.a.WebmWasmEngine;break;default:throw new Error("Unknown videoEngine: "+e)}return t}(this.videoEngine),i=this.videoEngine}try{this.engine=new e(this.player,this.player.options_)}catch(e){throw new Error("Could not load "+i+" plugin")}if(this.engine.on(m.RECORD_COMPLETE,this.engineStopCallback),this.engine.bufferSize=this.audioBufferSize,this.engine.sampleRate=this.audioSampleRate,this.engine.bitRate=this.audioBitRate,this.engine.audioChannels=this.audioChannels,this.engine.audioWorkerURL=this.audioWorkerURL,this.engine.audioWebAssemblyURL=this.audioWebAssemblyURL,this.engine.mimeType={video:this.videoMimeType,gif:"image/gif"},null!==this.audioMimeType&&this.audioMimeType!==oe&&(this.engine.mimeType.audio=this.audioMimeType),this.engine.videoWorkerURL=this.videoWorkerURL,this.engine.videoWebAssemblyURL=this.videoWebAssemblyURL,this.engine.videoBitRate=this.videoBitRate,this.engine.videoFrameRate=this.videoFrameRate,this.engine.video={width:this.videoFrameWidth,height:this.videoFrameHeight},this.engine.canvas={width:this.videoFrameWidth,height:this.videoFrameHeight},this.engine.quality=this.animationQuality,this.engine.frameRate=this.animationFrameRate,this.recordTimeSlice&&this.recordTimeSlice>0&&(this.engine.timeSlice=this.recordTimeSlice,this.engine.maxFileSize=this.maxFileSize),this.engine.pluginLibraryOptions=this.pluginLibraryOptions,this.engine.setup(this.stream,this.mediaType,this.debug),""!==this.convertEngine){let e=function(e){let t;switch(e){case"":break;case"ts-ebml":t=s.a.TsEBMLEngine;break;case"ffmpeg.js":t=s.a.FFmpegjsEngine;break;default:throw new Error("Unknown convertEngine: "+e)}return t}(this.convertEngine);try{this.converter=new e(this.player,this.player.options_)}catch(e){throw new Error("Could not load "+this.convertEngine+" plugin")}this.converter.convertWorkerURL=this.convertWorkerURL,this.converter.convertOptions=this.convertOptions,this.converter.pluginLibraryOptions=this.pluginLibraryOptions,this.converter.setup(this.mediaType,this.debug)}["currentTimeDisplay","timeDivider","durationDisplay"].forEach(e=>{void 0!==(e=this.player.controlBar[e])&&(e.el().style.display="block",e.show())}),this.player.recordToggle.show()}else this.player.recordIndicator.disable(),this.retrySnapshot();var t;this.getRecordType()!==U?(this.mediaElement=this.player.el().firstChild,this.mediaElement.controls=!1,this.mediaElement.muted=!0,this.displayVolumeControl(!1),!0===this.pictureInPicture&&(this.player.pipToggle.show(),this.mediaElement.removeEventListener(m.ENTERPICTUREINPICTURE,this.onEnterPiPHandler),this.mediaElement.removeEventListener(m.LEAVEPICTUREINPICTURE,this.onLeavePiPHandler),this.mediaElement.addEventListener(m.ENTERPICTUREINPICTURE,this.onEnterPiPHandler),this.mediaElement.addEventListener(m.LEAVEPICTUREINPICTURE,this.onLeavePiPHandler)),this.load(this.stream),this.player.one(m.LOADEDMETADATA,()=>{this.mediaElement.play(),this.player.trigger(m.DEVICE_READY)})):this.player.trigger(m.DEVICE_READY)}onDeviceError(e){this._deviceActive=!1,this.isDestroyed()||(this.player.deviceErrorCode=e,this.player.trigger(m.DEVICE_ERROR))}start(){if(!this.isProcessing()){switch(this._recording=!0,void 0!==this.player.controlBar.playToggle&&this.player.controlBar.playToggle.hide(),this.off(this.player,m.TIMEUPDATE,this.playbackTimeUpdate),this.off(this.player,m.ENDED,this.playbackTimeUpdate),this.getRecordType()){case U:this.surfer.setupPlaybackEvents(!1),this.surfer.surfer.microphone.paused=!1,this.surfer.liveMode=!0,this.surfer.surfer.microphone.play();break;case"video_only":case"audio_video":case"audio_screen":case"screen_only":this.startVideoPreview();break;case L:this.player.recordCanvas.hide(),this.player.animationDisplay.hide(),this.mediaElement.style.display="block",this.captureFrame().then(e=>{this.startVideoPreview()})}switch(this.autoMuteDevice&&this.muteTracks(!1),this.getRecordType()){case I:this.createSnapshot(),this.player.trigger(m.START_RECORD);break;case"video_only":case"audio_video":case"audio_screen":case L:case"screen_only":this.player.one(m.LOADEDMETADATA,()=>{this.startRecording()});break;default:this.startRecording()}}}startRecording(){this.paused=!1,this.pauseTime=this.pausedTime=0,this.startTime=performance.now();this.countDown=this.player.setInterval(this.onCountDown.bind(this),100),void 0!==this.engine&&this.engine.dispose(),this.engine.start(),this.player.trigger(m.START_RECORD)}stop(){this.isProcessing()||(this._recording=!1,this._processing=!0,this.getRecordType()!==I?(this.player.trigger(m.STOP_RECORD),this.player.clearInterval(this.countDown),this.engine&&this.engine.stop(),this.autoMuteDevice&&this.muteTracks(!0)):this.player.recordedData&&this.player.trigger(m.FINISH_RECORD))}stopDevice(){this.isRecording()?(this.player.one(m.FINISH_RECORD,this.stopStream.bind(this)),this.stop()):this.stopStream()}stopStream(){if(this.stream){if(this._deviceActive=!1,this.getRecordType()===U)return void this.surfer.surfer.microphone.stopDevice();this.stream.getTracks().forEach(e=>{e.stop()})}}pause(){this.paused||(this.pauseTime=performance.now(),this.paused=!0,this.engine.pause())}resume(){this.paused&&(this.pausedTime+=performance.now()-this.pauseTime,this.engine.resume(),this.paused=!1)}onRecordComplete(){if(this.player.recordedData=this.engine.recordedData,void 0!==this.player.controlBar.playToggle&&(this.player.controlBar.playToggle.removeClass("vjs-ended"),this.player.controlBar.playToggle.show()),void 0!==this.converter&&this.converter.convert(this.player.recordedData),this.player.trigger(m.FINISH_RECORD),!this.isDestroyed())switch(this.getRecordType()){case U:this.surfer.pause(),this.surfer.setupPlaybackEvents(!0),this.player.loadingSpinner.show(),this.surfer.surfer.once(m.READY,()=>{this._processing=!1}),this.load(this.player.recordedData);break;case"video_only":case"audio_video":case"audio_screen":case"screen_only":this.player.one(m.PAUSE,()=>{this._processing=!1,this.player.loadingSpinner.hide(),this.setDuration(this.streamDuration),this.on(this.player,m.TIMEUPDATE,this.playbackTimeUpdate),this.on(this.player,m.ENDED,this.playbackTimeUpdate),"audio_video"!==this.getRecordType()&&"audio_screen"!==this.getRecordType()||(this.mediaElement.muted=!1,this.displayVolumeControl(!0)),this.load(this.player.recordedData)}),this.player.pause();break;case L:this._processing=!1,this.player.loadingSpinner.hide(),this.setDuration(this.streamDuration),this.mediaElement.style.display="none",this.player.recordCanvas.show(),this.player.pause(),this.on(this.player,m.PLAY,this.showAnimation),this.on(this.player,m.PAUSE,this.hideAnimation)}}onCountDown(){if(!this.paused){let e=performance.now(),t=this.maxLength,i=(e-(this.startTime+this.pausedTime))/1e3;this.streamDuration=i,i>=t&&(i=t,this.stop()),this.setDuration(t),this.setCurrentTime(i,t),this.player.trigger(m.PROGRESS_RECORD)}}getCurrentTime(){let e=isNaN(this.streamCurrentTime)?0:this.streamCurrentTime;return this.getRecordType()===U&&(e=this.surfer.getCurrentTime()),e}setCurrentTime(e,t){switch(e=isNaN(e)?0:e,t=isNaN(t)?0:t,this.getRecordType()){case U:this.surfer.setCurrentTime(e,t);break;case"video_only":case"audio_video":case"audio_screen":case L:case"screen_only":this.player.controlBar.currentTimeDisplay&&this.player.controlBar.currentTimeDisplay.contentEl()&&(this.streamCurrentTime=Math.min(e,t),this.player.controlBar.currentTimeDisplay.formattedTime_=this.player.controlBar.currentTimeDisplay.contentEl().lastChild.textContent=j(this.streamCurrentTime,t,this.msDisplayMax))}}getDuration(){return isNaN(this.streamDuration)?0:this.streamDuration}setDuration(e){switch(e=isNaN(e)?0:e,this.getRecordType()){case U:this.surfer.setDuration(e);break;case"video_only":case"audio_video":case"audio_screen":case L:case"screen_only":this.player.controlBar.durationDisplay&&this.player.controlBar.durationDisplay.contentEl()&&(this.player.controlBar.durationDisplay.formattedTime_=this.player.controlBar.durationDisplay.contentEl().lastChild.textContent=j(e,e,this.msDisplayMax))}}load(e){switch(this.getRecordType()){case U:this.surfer.load(e);break;case I:case"video_only":case"audio_video":case"audio_screen":case L:case"screen_only":e instanceof Blob||e instanceof File?(this.mediaElement.srcObject=null,this.mediaElement.src=URL.createObjectURL(e)):N(e,this.mediaElement)}}saveAs(e){this.engine&&void 0!==e&&this.engine.saveAs(e)}dispose(){this.player.off(m.READY),this.player.off(m.USERINACTIVE),this.player.off(m.LOADEDMETADATA),this.engine&&(this.engine.dispose(),this.engine.destroy(),this.engine.off(m.RECORD_COMPLETE,this.engineStopCallback)),this.stop(),this.stopDevice(),this.removeRecording(),this.player.clearInterval(this.countDown),this.getRecordType()===U?this.surfer&&this.surfer.destroy():this.getRecordType()===I&&this.mediaElement&&this.streamVisibleCallback&&this.mediaElement.removeEventListener(m.PLAYING,this.streamVisibleCallback),this.resetState(),super.dispose()}destroy(){this.player.dispose()}reset(){switch(this.engine&&(this.engine.dispose(),this.engine.off(m.RECORD_COMPLETE,this.engineStopCallback)),this.stop(),this.stopDevice(),this.player.clearInterval(this.countDown),this.removeRecording(),this.loadOptions(),this.resetState(),this.setDuration(this.maxLength),this.setCurrentTime(0),this.player.reset(),this.getRecordType()){case U:this.surfer&&this.surfer.surfer&&this.surfer.surfer.empty();break;case I:case L:this.player.recordCanvas.hide(),this.player.cameraButton.hide()}void 0!==this.player.controlBar.playToggle&&this.player.controlBar.playToggle.hide(),this.player.deviceButton.show(),this.player.recordToggle.hide(),this.player.one(m.LOADEDMETADATA,()=>{this.setDuration(this.maxLength)})}resetState(){this._recording=!1,this._processing=!1,this._deviceActive=!1,this.devices=[]}removeRecording(){this.mediaElement&&!0===this.mediaElement.src.startsWith("blob:")&&(URL.revokeObjectURL(this.mediaElement.src),this.mediaElement.src="")}muteTracks(e){(this.getRecordType()===U||"audio_screen"===this.getRecordType()||"audio_video"===this.getRecordType())&&this.stream.getAudioTracks().length>0&&(this.stream.getAudioTracks()[0].enabled=!e),this.getRecordType()!==U&&this.stream.getVideoTracks().length>0&&(this.stream.getVideoTracks()[0].enabled=!e)}getRecordType(){return e=this.recordImage,t=this.recordAudio,i=this.recordVideo,r=this.recordAnimation,s=this.recordScreen,B(e)?I:B(r)?L:B(t)&&B(i)?"audio_video":B(t)&&B(s)?"audio_screen":!B(t)&&B(s)?"screen_only":B(t)&&!B(i)?U:!B(t)&&B(i)?"video_only":void 0;var e,t,i,r,s}createSnapshot(){this.captureFrame().then(e=>{"blob"===this.imageOutputType?e.toBlob(e=>{this.player.recordedData=e,this.displaySnapshot()}):"dataURL"===this.imageOutputType&&(this.player.recordedData=e.toDataURL(this.imageOutputFormat,this.imageOutputQuality),this.displaySnapshot())},this.imageOutputFormat,this.imageOutputQuality)}displaySnapshot(){this.mediaElement.style.display="none",this.player.recordCanvas.show(),this.stop()}retrySnapshot(){this._processing=!1,this.player.recordCanvas.hide(),this.player.el().firstChild.style.display="block"}captureFrame(){let e=Y(),t=this.player.recordCanvas.el().firstChild;return t.width=this.player.width(),t.height=this.player.height(),new Promise((i,r)=>{if("chrome"===e.browser&&e.version>=60&&typeof ImageCapture==typeof Function)try{let e=this.stream.getVideoTracks()[0];new ImageCapture(e).grabFrame().then(e=>{this.drawCanvas(t,e),i(t)}).catch(e=>{})}catch(e){}this.drawCanvas(t,this.mediaElement),i(t)})}drawCanvas(e,t){e.getContext("2d").drawImage(t,0,0,e.width,e.height)}startVideoPreview(){this.off(m.TIMEUPDATE),this.off(m.DURATIONCHANGE),this.off(m.LOADEDMETADATA),this.off(m.PLAY),this.mediaElement.muted=!0,this.displayVolumeControl(!1),this.removeRecording(),this.load(this.stream),this.mediaElement.play()}showAnimation(){let e=this.player.animationDisplay.el().firstChild;e.width=this.player.width(),e.height=this.player.height(),this.player.recordCanvas.hide(),N(this.player.recordedData,e),this.player.animationDisplay.show()}hideAnimation(){this.player.recordCanvas.show(),this.player.animationDisplay.hide()}playbackTimeUpdate(){this.setCurrentTime(this.player.currentTime(),this.streamDuration)}enumerateDevices(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return this.player.enumerateErrorCode="enumerateDevices() not supported.",void this.player.trigger(m.ENUMERATE_ERROR);navigator.mediaDevices.enumerateDevices(this).then(e=>{this.devices=[],e.forEach(e=>{this.devices.push(e)}),this.player.trigger(m.ENUMERATE_READY)}).catch(e=>{this.player.enumerateErrorCode=e,this.player.trigger(m.ENUMERATE_ERROR)})}setVideoInput(e){this.recordVideo===Object(this.recordVideo)?this.recordVideo.deviceId={exact:e}:!0===this.recordVideo&&(this.recordVideo={deviceId:{exact:e}}),this.stopDevice(),this.getDevice()}setAudioInput(e){switch(this.recordAudio===Object(this.recordAudio)?this.recordAudio.deviceId={exact:e}:!0===this.recordAudio&&(this.recordAudio={deviceId:{exact:e}}),this.getRecordType()){case U:this.surfer.surfer.microphone.constraints={video:!1,audio:this.recordAudio}}this.stopDevice(),this.getDevice()}setAudioOutput(e){let t;switch(this.getRecordType()){case U:this.surfer.surfer.setSinkId(e).then(e=>{this.player.trigger(m.AUDIO_OUTPUT_READY)}).catch(e=>{t=e});break;default:let i=player.tech_.el_;e?void 0!==i.sinkId?i.setSinkId(e).then(e=>{this.player.trigger(m.AUDIO_OUTPUT_READY)}).catch(e=>{t=e}):t="Browser does not support audio output device selection.":t=`Invalid deviceId: ${e}`}this.player.trigger(m.ERROR,t)}displayVolumeControl(e){void 0!==this.player.controlBar.volumePanel&&(e=!0===e?"flex":"none",this.player.controlBar.volumePanel.el().style.display=e)}onStreamVisible(e){this.mediaElement.removeEventListener(m.PLAYING,this.streamVisibleCallback),this.player.cameraButton.onStop(),this.player.cameraButton.show()}onEnterPiP(e){this.player.trigger(m.ENTER_PIP,e)}onLeavePiP(e){this.player.trigger(m.LEAVE_PIP)}}ae.VERSION="3.9.0",s.a.Record=ae,void 0===s.a.getPlugin("record")&&s.a.registerPlugin("record",ae)}])}));